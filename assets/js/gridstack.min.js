/**
 * gridstack.js 1.1.1
 * https://gridstackjs.com/
 * (c) 2014-2020 Alain Dumesny, Dylan Weiss, Pavel Reznikov
 * gridstack.js may be freely distributed under the MIT license.
 * @preserve
*/
!function(factory){factory(window.jQuery,window)}((function($,scope){var obsolete=function(f,oldName,newName,rev){var wrapper=function(){return console.warn("gridstack.js: Function `"+oldName+"` is deprecated in "+rev+" and has been replaced with `"+newName+"`. It will be **completely** removed in v1.0"),f.apply(this,arguments)};return wrapper.prototype=f.prototype,wrapper},obsoleteOpts=function(opts,oldName,newName,rev){void 0!==opts[oldName]&&(opts[newName]=opts[oldName],console.warn("gridstack.js: Option `"+oldName+"` is deprecated in "+rev+" and has been replaced with `"+newName+"`. It will be **completely** removed in v1.0"))},obsoleteOptsDel=function(opts,oldName,rev,info){void 0!==opts[oldName]&&console.warn("gridstack.js: Option `"+oldName+"` is deprecated in "+rev+info)},obsoleteAttr=function(el,oldName,newName,rev){var oldAttr=el.attr(oldName);void 0!==oldAttr&&(el.attr(newName,oldAttr),console.warn("gridstack.js: attribute `"+oldName+"`="+oldAttr+" is deprecated on this object in "+rev+" and has been replaced with `"+newName+"`. It will be **completely** removed in v1.0"))},Utils={isIntercepted:function(a,b){return!(a.x+a.width<=b.x||b.x+b.width<=a.x||a.y+a.height<=b.y||b.y+b.height<=a.y)},sort:function(nodes,dir,column){if(!column){var widths=nodes.map((function(node){return node.x+node.width}));column=Math.max.apply(Math,widths)}return-1===dir?Utils.sortBy(nodes,(function(n){return-(n.x+n.y*column)})):Utils.sortBy(nodes,(function(n){return n.x+n.y*column}))},createStylesheet:function(id,parent){var style=document.createElement("style");return style.setAttribute("type","text/css"),style.setAttribute("data-gs-style-id",id),style.styleSheet?style.styleSheet.cssText="":style.appendChild(document.createTextNode("")),parent||(parent=document.getElementsByTagName("head")[0]),parent.insertBefore(style,parent.firstChild),style.sheet},removeStylesheet:function(id){$("STYLE[data-gs-style-id="+id+"]").remove()},insertCSSRule:function(sheet,selector,rules,index){"function"==typeof sheet.insertRule?sheet.insertRule(selector+"{"+rules+"}",index):"function"==typeof sheet.addRule&&sheet.addRule(selector,rules,index)},toBool:function(v){return"boolean"==typeof v?v:"string"==typeof v?!(""===(v=v.toLowerCase())||"no"===v||"false"===v||"0"===v):Boolean(v)},_collisionNodeCheck:function(n){return n!==this.node&&Utils.isIntercepted(n,this.nn)},_didCollide:function(bn){return Utils.isIntercepted({x:this.n.x,y:this.newY,width:this.n.width,height:this.n.height},bn)},_isAddNodeIntercepted:function(n){return Utils.isIntercepted({x:this.x,y:this.y,width:this.node.width,height:this.node.height},n)},parseHeight:function(val){var height=val,heightUnit="px";if(height&&"string"==typeof height){var match=height.match(/^(-[0-9]+\.[0-9]+|[0-9]*\.[0-9]+|-[0-9]+|[0-9]+)(px|em|rem|vh|vw|%)?$/);if(!match)throw new Error("Invalid height");heightUnit=match[2]||"px",height=parseFloat(match[1])}return{height:height,unit:heightUnit}},without:function(array,item){var index=array.indexOf(item);return-1!==index&&(array=array.slice(0)).splice(index,1),array},sortBy:function(array,getter){return array.slice(0).sort((function(left,right){var valueLeft=getter(left),valueRight=getter(right);return valueRight===valueLeft?0:valueLeft>valueRight?1:-1}))},defaults:function(target){var sources=Array.prototype.slice.call(arguments,1);return sources.forEach((function(source){for(var prop in source)!source.hasOwnProperty(prop)||target.hasOwnProperty(prop)&&void 0!==target[prop]||(target[prop]=source[prop])})),target},clone:function(target){return $.extend({},target)},throttle:function(callback,delay){var isWaiting=!1;return function(){isWaiting||(callback.apply(this,arguments),isWaiting=!0,setTimeout((function(){isWaiting=!1}),delay))}},removePositioningStyles:function(el){var style=el[0].style;style.position&&style.removeProperty("position"),style.left&&style.removeProperty("left"),style.top&&style.removeProperty("top"),style.width&&style.removeProperty("width"),style.height&&style.removeProperty("height")},getScrollParent:function(el){var returnEl;return returnEl=null===el?null:el.scrollHeight>el.clientHeight?el:Utils.getScrollParent(el.parentNode)},updateScrollPosition:function(el,ui,distance){var rect=el.getBoundingClientRect(),innerHeightOrClientHeight=window.innerHeight||document.documentElement.clientHeight;if(rect.top<0||rect.bottom>innerHeightOrClientHeight){var offsetDiffDown=rect.bottom-innerHeightOrClientHeight,offsetDiffUp=rect.top,scrollEl=Utils.getScrollParent(el);if(null!==scrollEl){var prevScroll=scrollEl.scrollTop;rect.top<0&&distance<0?el.offsetHeight>innerHeightOrClientHeight?scrollEl.scrollTop+=distance:scrollEl.scrollTop+=Math.abs(offsetDiffUp)>Math.abs(distance)?distance:offsetDiffUp:distance>0&&(el.offsetHeight>innerHeightOrClientHeight?scrollEl.scrollTop+=distance:scrollEl.scrollTop+=offsetDiffDown>distance?distance:offsetDiffDown),ui.position.top+=scrollEl.scrollTop-prevScroll}}}};function GridStackDragDropPlugin(grid){this.grid=grid}GridStackDragDropPlugin.registeredPlugins=[],GridStackDragDropPlugin.registerPlugin=function(pluginClass){GridStackDragDropPlugin.registeredPlugins.push(pluginClass)},GridStackDragDropPlugin.prototype.resizable=function(el,opts){return this},GridStackDragDropPlugin.prototype.draggable=function(el,opts){return this},GridStackDragDropPlugin.prototype.droppable=function(el,opts){return this},GridStackDragDropPlugin.prototype.isDroppable=function(el){return!1},GridStackDragDropPlugin.prototype.on=function(el,eventName,callback){return this};var idSeq=0,GridStackEngine=function(column,onchange,float,maxRow,items){this.column=column||12,this.float=float||!1,this.maxRow=maxRow||0,this.nodes=items||[],this.onchange=onchange||function(){},this._addedNodes=[],this._removedNodes=[],this._batchMode=!1};GridStackEngine.prototype.batchUpdate=function(){this._batchMode||(this._batchMode=!0,this._prevFloat=this.float,this.float=!0)},GridStackEngine.prototype.commit=function(){this._batchMode&&(this._batchMode=!1,this.float=this._prevFloat,delete this._prevFloat,this._packNodes(),this._notify())},GridStackEngine.prototype.getNodeDataByDOMEl=function(el){return this.nodes.find((function(node){return el===node.el}))},GridStackEngine.prototype._fixCollisions=function(node){var self=this;this._sortNodes(-1);var nn=node,hasLocked=Boolean(this.nodes.find((function(n){})));for(this.float||hasLocked||(nn={x:0,y:node.y,width:this.column,height:node.height});;){var collisionNode=this.nodes.find(Utils._collisionNodeCheck,{node:node,nn:nn}),moved;if(!collisionNode)return;if(!(moved=collisionNode.locked?this.moveNode(node,node.x,collisionNode.y+collisionNode.height,node.width,node.height,!0):this.moveNode(collisionNode,collisionNode.x,node.y+node.height,collisionNode.width,collisionNode.height,!0)))return}},GridStackEngine.prototype.isAreaEmpty=function(x,y,width,height){var nn={x:x||0,y:y||0,width:width||1,height:height||1},collisionNode;return!this.nodes.find((function(n){return Utils.isIntercepted(n,nn)}))},GridStackEngine.prototype._sortNodes=function(dir){this.nodes=Utils.sort(this.nodes,dir,this.column)},GridStackEngine.prototype._packNodes=function(){this._sortNodes(),this.float?this.nodes.forEach((function(n,i){if(!n._updating&&void 0!==n._packY&&n.y!==n._packY)for(var newY=n.y;newY>=n._packY;){var collisionNode;this.nodes.slice(0,i).find(Utils._didCollide,{n:n,newY:newY})||(n._dirty=!0,n.y=newY),--newY}}),this):this.nodes.forEach((function(n,i){if(!n.locked)for(;n.y>0;){var newY=n.y-1,canBeMoved=0===i,collisionNode;if(i>0)canBeMoved=void 0===this.nodes.slice(0,i).find(Utils._didCollide,{n:n,newY:newY});if(!canBeMoved)break;n._dirty=n.y!==newY,n.y=newY}}),this)},GridStackEngine.prototype._prepareNode=function(node,resizing){void 0!==(node=node||{}).x&&void 0!==node.y&&null!==node.x&&null!==node.y||(node.autoPosition=!0);var defaults={width:1,height:1,x:0,y:0};return(node=Utils.defaults(node,defaults)).x=parseInt(node.x),node.y=parseInt(node.y),node.width=parseInt(node.width),node.height=parseInt(node.height),node.autoPosition=node.autoPosition||!1,node.noResize=node.noResize||!1,node.noMove=node.noMove||!1,Number.isNaN(node.x)&&(node.x=defaults.x,node.autoPosition=!0),Number.isNaN(node.y)&&(node.y=defaults.y,node.autoPosition=!0),Number.isNaN(node.width)&&(node.width=defaults.width),Number.isNaN(node.height)&&(node.height=defaults.height),void 0!==node.maxWidth&&(node.width=Math.min(node.width,node.maxWidth)),void 0!==node.maxHeight&&(node.height=Math.min(node.height,node.maxHeight)),void 0!==node.minWidth&&(node.width=Math.max(node.width,node.minWidth)),void 0!==node.minHeight&&(node.height=Math.max(node.height,node.minHeight)),node.width>this.column?node.width=this.column:node.width<1&&(node.width=1),this.maxRow&&node.height>this.maxRow?node.height=this.maxRow:node.height<1&&(node.height=1),node.x<0&&(node.x=0),node.y<0&&(node.y=0),node.x+node.width>this.column&&(resizing?node.width=this.column-node.x:node.x=this.column-node.width),this.maxRow&&node.y+node.height>this.maxRow&&(resizing?node.height=this.maxRow-node.y:node.y=this.maxRow-node.height),node},GridStackEngine.prototype._notify=function(){if(!this._batchMode){var args=Array.prototype.slice.call(arguments,0);args[0]=void 0===args[0]?[]:Array.isArray(args[0])?args[0]:[args[0]],args[1]=void 0===args[1]||args[1];var dirtyNodes=args[0].concat(this.getDirtyNodes());this.onchange(dirtyNodes,args[1])}},GridStackEngine.prototype.cleanNodes=function(){this._batchMode||this.nodes.forEach((function(n){delete n._dirty}))},GridStackEngine.prototype.getDirtyNodes=function(verify){if(verify){var dirtNodes=[];return this.nodes.forEach((function(n){n._dirty&&(n.y===n._origY&&n.x===n._origX&&n.width===n._origW&&n.height===n._origH?delete n._dirty:dirtNodes.push(n))})),dirtNodes}return this.nodes.filter((function(n){return n._dirty}))},GridStackEngine.prototype.addNode=function(node,triggerAddEvent){if((node=this._prepareNode(node))._id=node._id||++idSeq,node.autoPosition){this._sortNodes();for(var i=0;;++i){var x=i%this.column,y=Math.floor(i/this.column);if(!(x+node.width>this.column)&&!this.nodes.find(Utils._isAddNodeIntercepted,{x:x,y:y,node:node})){node.x=x,node.y=y,delete node.autoPosition;break}}}return this.nodes.push(node),triggerAddEvent&&this._addedNodes.push(node),this._fixCollisions(node),this._packNodes(),this._notify(),node},GridStackEngine.prototype.removeNode=function(node,detachNode){detachNode=void 0===detachNode||detachNode,this._removedNodes.push(node),node._id=null,this.nodes=Utils.without(this.nodes,node),this._packNodes(),this._notify(node,detachNode)},GridStackEngine.prototype.removeAll=function(detachNode){delete this._layouts,0!==this.nodes.length&&(detachNode=void 0===detachNode||detachNode,this.nodes.forEach((function(n){n._id=null})),this._removedNodes=this.nodes,this.nodes=[],this._notify(this._removedNodes,detachNode))},GridStackEngine.prototype.canMoveNode=function(node,x,y,width,height){if(!this.isNodeChangedPosition(node,x,y,width,height))return!1;var hasLocked=Boolean(this.nodes.find((function(n){return n.locked}))),clonedNode;if(!this.maxRow&&!hasLocked)return!0;var clone=new GridStackEngine(this.column,null,this.float,0,this.nodes.map((function(n){return n===node?clonedNode=$.extend({},n):$.extend({},n)})));if(!clonedNode)return!0;clone.moveNode(clonedNode,x,y,width,height);var res=!0;return hasLocked&&(res&=!Boolean(clone.nodes.find((function(n){return n!==clonedNode&&Boolean(n.locked)&&Boolean(n._dirty)})))),this.maxRow&&(res&=clone.getRow()<=this.maxRow),res},GridStackEngine.prototype.canBePlacedWithRespectToHeight=function(node){if(!this.maxRow)return!0;var clone=new GridStackEngine(this.column,null,this.float,0,this.nodes.map((function(n){return $.extend({},n)})));return clone.addNode(node),clone.getRow()<=this.maxRow},GridStackEngine.prototype.isNodeChangedPosition=function(node,x,y,width,height){return"number"!=typeof x&&(x=node.x),"number"!=typeof y&&(y=node.y),"number"!=typeof width&&(width=node.width),"number"!=typeof height&&(height=node.height),void 0!==node.maxWidth&&(width=Math.min(width,node.maxWidth)),void 0!==node.maxHeight&&(height=Math.min(height,node.maxHeight)),void 0!==node.minWidth&&(width=Math.max(width,node.minWidth)),void 0!==node.minHeight&&(height=Math.max(height,node.minHeight)),node.x!==x||node.y!==y||node.width!==width||node.height!==height},GridStackEngine.prototype.moveNode=function(node,x,y,width,height,noPack){if(node.locked)return null;"number"!=typeof x&&(x=node.x),"number"!=typeof y&&(y=node.y),"number"!=typeof width&&(width=node.width),"number"!=typeof height&&(height=node.height);var resizing=node.width!==width||node.height!==height,nn={x:x,y:y,width:width,height:height,maxWidth:node.maxWidth,maxHeight:node.maxHeight,minWidth:node.minWidth,minHeight:node.minHeight};if(nn=this._prepareNode(nn,resizing),node.x===nn.x&&node.y===nn.y&&node.width===nn.width&&node.height===nn.height)return null;node._dirty=!0,node.x=node.lastTriedX=nn.x,node.y=node.lastTriedY=nn.y,node.width=node.lastTriedWidth=nn.width,node.height=node.lastTriedHeight=nn.height;var disableCollision=this.nodes[0]._grid.opts.disableCollisionClass,nodeElement;return $("#"+node.id).hasClass(disableCollision)||this._fixCollisions(node),noPack||(this._packNodes(),this._notify()),node},GridStackEngine.prototype.getRow=function(){return this.nodes.reduce((function(memo,n){return Math.max(memo,n.y+n.height)}),0)},GridStackEngine.prototype.beginUpdate=function(node){node._updating||(node._updating=!0,this.nodes.forEach((function(n){n._packY=n.y})))},GridStackEngine.prototype.endUpdate=function(){var n=this.nodes.find((function(n){return n._updating}));n&&(n._updating=!1,this.nodes.forEach((function(n){delete n._packY})))};var GridStack=function(el,opts){var self=this,oneColumnMode,_prevColumn,isAutoCellHeight;opts=opts||{},this.$el=$(el),this.el=this.$el.get(0),obsoleteOpts(opts,"width","column","v0.5.3"),obsoleteOpts(opts,"height","maxRow","v0.5.3"),obsoleteOptsDel(opts,"oneColumnModeClass","v0.6.3",". Use class `.grid-stack-1` instead"),obsoleteAttr(this.$el,"data-gs-width","data-gs-column","v0.5.3"),obsoleteAttr(this.$el,"data-gs-height","data-gs-max-row","v0.5.3"),obsoleteAttr(this.$el,"data-gs-current-height","data-gs-current-row","v1.0.0"),opts.itemClass=opts.itemClass||"grid-stack-item";var isNested=this.$el.closest("."+opts.itemClass).length>0;opts.row&&(opts.minRow=opts.maxRow=opts.row,delete opts.row);var rowAttr=parseInt(this.$el.attr("data-gs-row"));if(this.opts=Utils.defaults(opts,{column:parseInt(this.$el.attr("data-gs-column"))||12,minRow:rowAttr||(parseInt(this.$el.attr("data-gs-min-row"))||0),maxRow:rowAttr||(parseInt(this.$el.attr("data-gs-max-row"))||0),itemClass:"grid-stack-item",placeholderClass:"grid-stack-placeholder",placeholderText:"",handle:".grid-stack-item-content",handleClass:null,cellHeight:60,verticalMargin:20,auto:!0,minWidth:768,float:!1,staticGrid:!1,_class:"grid-stack-instance-"+(1e4*Math.random()).toFixed(0),animate:Boolean(this.$el.attr("data-gs-animate"))||!1,alwaysShowResizeHandle:opts.alwaysShowResizeHandle||!1,resizable:Utils.defaults(opts.resizable||{},{autoHide:!opts.alwaysShowResizeHandle,handles:"se"}),draggable:Utils.defaults(opts.draggable||{},{handle:(opts.handleClass?"."+opts.handleClass:opts.handle?opts.handle:"")||".grid-stack-item-content",scroll:!1,appendTo:"body"}),disableDrag:opts.disableDrag||!1,disableResize:opts.disableResize||!1,rtl:"auto",removable:!1,removableOptions:Utils.defaults(opts.removableOptions||{},{accept:"."+opts.itemClass}),removeTimeout:2e3,verticalMarginUnit:"px",cellHeightUnit:"px",disableOneColumnMode:opts.disableOneColumnMode||!1,oneColumnModeDomSort:opts.oneColumnModeDomSort,ddPlugin:null,disableCollisionClass:"disableCollision"}),!1===this.opts.ddPlugin?this.opts.ddPlugin=GridStackDragDropPlugin:null===this.opts.ddPlugin&&(this.opts.ddPlugin=GridStackDragDropPlugin.registeredPlugins[0]||GridStackDragDropPlugin),this.dd=new this.opts.ddPlugin(this),"auto"===this.opts.rtl&&(this.opts.rtl="rtl"===this.$el.css("direction")),this.opts.rtl&&this.$el.addClass("grid-stack-rtl"),this.opts.isNested=isNested,(isAutoCellHeight="auto"===this.opts.cellHeight)?self.cellHeight(self.cellWidth(),!0):this.cellHeight(this.opts.cellHeight,!0),this.verticalMargin(this.opts.verticalMargin,!0),this.$el.addClass(this.opts._class),this._setStaticClass(),isNested&&this.$el.addClass("grid-stack-nested"),this._initStyles(),this.engine=new GridStackEngine(this.opts.column,(function(nodes,detachNode){detachNode=void 0===detachNode||detachNode;var maxHeight=0;this.nodes.forEach((function(n){maxHeight=Math.max(maxHeight,n.y+n.height)})),nodes.forEach((function(n){detachNode&&null===n._id?n.el&&$(n.el).remove():$(n.el).attr("data-gs-x",n.x).attr("data-gs-y",n.y).attr("data-gs-width",n.width).attr("data-gs-height",n.height)})),self._updateStyles(maxHeight+10)}),this.opts.float,this.opts.maxRow),this.opts.auto){var elements=[],_this=this;this.$el.children("."+this.opts.itemClass+":not(."+this.opts.placeholderClass+")").each((function(index,el){el=$(el);var x=parseInt(el.attr("data-gs-x")),y=parseInt(el.attr("data-gs-y"));elements.push({el:el.get(0),i:(Number.isNaN(x)?1e3:x)+(Number.isNaN(y)?1e3:y)*_this.opts.column})})),Utils.sortBy(elements,(function(x){return x.i})).forEach((function(item){this._prepareElement(item.el)}),this)}if(this.engine._saveInitial(),this.setAnimation(this.opts.animate),this.placeholder=$('<div class="'+this.opts.placeholderClass+" "+this.opts.itemClass+'"><div class="placeholder-content">'+this.opts.placeholderText+"</div></div>").hide(),this._updateContainerHeight(),this._updateHeightsOnResize=Utils.throttle((function(){self.cellHeight(self.cellWidth(),!1)}),100),this.onResizeHandler=function(){if(isAutoCellHeight&&self._updateHeightsOnResize(),!self.opts.staticGrid)if(!self.opts.disableOneColumnMode&&(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=self.opts.minWidth){if(self.oneColumnMode)return;self.oneColumnMode=!0,self.column(1)}else{if(!self.oneColumnMode)return;self.oneColumnMode=!1,self.column(self._prevColumn)}},$(window).resize(this.onResizeHandler),this.onResizeHandler(),!self.opts.staticGrid&&"string"==typeof self.opts.removable){var trashZone=$(self.opts.removable);this.dd.isDroppable(trashZone)||this.dd.droppable(trashZone,self.opts.removableOptions),this.dd.on(trashZone,"dropover",(function(event,ui){var el=$(ui.draggable),node=el.data("_gridstack_node");node&&node._grid===self&&(el.data("inTrashZone",!0),self._setupRemovingTimeout(el))})).on(trashZone,"dropout",(function(event,ui){var el=$(ui.draggable),node=el.data("_gridstack_node");node&&node._grid===self&&(el.data("inTrashZone",!1),self._clearRemovingTimeout(el))}))}if(!self.opts.staticGrid&&self.opts.acceptWidgets){var draggingElement=null,onDrag=function(event,ui){var el=draggingElement,node=el.data("_gridstack_node"),pos=self.getCellFromPixel({left:event.pageX,top:event.pageY},!0),x=Math.max(0,pos.x),y=Math.max(0,pos.y);node._added||(node._added=!0,node.el=el.get(0),node.autoPosition=!0,node.x=x,node.y=y,self.engine.cleanNodes(),self.engine.beginUpdate(node),self.engine.addNode(node),self.$el.append(self.placeholder),self.placeholder.attr("data-gs-x",node.x).attr("data-gs-y",node.y).attr("data-gs-width",node.width).attr("data-gs-height",node.height).show(),node.el=self.placeholder.get(0),node._beforeDragX=node.x,node._beforeDragY=node.y,self._updateContainerHeight()),self.engine.canMoveNode(node,x,y)&&(self.engine.moveNode(node,x,y),self._updateContainerHeight())};this.dd.droppable(self.$el,{accept:function(el){var node=(el=$(el)).data("_gridstack_node");return(!node||node._grid!==self)&&el.is(!0===self.opts.acceptWidgets?".grid-stack-item":self.opts.acceptWidgets)}}).on(self.$el,"dropover",(function(event,ui){var el=$(ui.draggable),width,height,origNode=el.data("_gridstack_node");if(!origNode||!origNode.width||!origNode.height){var w=parseInt(el.attr("data-gs-width"));w>0&&((origNode=origNode||{}).width=w);var h=parseInt(el.attr("data-gs-height"));h>0&&((origNode=origNode||{}).height=h)}var cellWidth=self.cellWidth(),cellHeight=self.cellHeight(),verticalMargin=self.opts.verticalMargin;width=origNode&&origNode.width?origNode.width:Math.ceil(el.outerWidth()/cellWidth),height=origNode&&origNode.height?origNode.height:Math.round((el.outerHeight()+verticalMargin)/(cellHeight+verticalMargin)),draggingElement=el;var node=self.engine._prepareNode({width:width,height:height,_added:!1,_temporary:!0});return node.isOutOfGrid=!0,el.data("_gridstack_node",node),el.data("_gridstack_node_orig",origNode),el.on("drag",onDrag),!1})).on(self.$el,"dropout",(function(event,ui){var el=$(ui.draggable);if(el.data("_gridstack_node")){var node=el.data("_gridstack_node");if(node.isOutOfGrid)return el.unbind("drag",onDrag),node.el=null,self.engine.removeNode(node),self.placeholder.detach(),self._updateContainerHeight(),el.data("_gridstack_node",el.data("_gridstack_node_orig")),!1}})).on(self.$el,"drop",(function(event,ui){self.placeholder.detach();var node=$(ui.draggable).data("_gridstack_node");node.isOutOfGrid=!1,node._grid=self;var el=$(ui.draggable).clone(!1);el.data("_gridstack_node",node);var originalNode=$(ui.draggable).data("_gridstack_node_orig");return void 0!==originalNode&&void 0!==originalNode._grid&&originalNode._grid._triggerRemoveEvent(),$(ui.helper).remove(),node.el=el.get(0),self.placeholder.hide(),Utils.removePositioningStyles(el),el.find("div.ui-resizable-handle").remove(),el.attr("data-gs-x",node.x).attr("data-gs-y",node.y).attr("data-gs-width",node.width).attr("data-gs-height",node.height).addClass(self.opts.itemClass).enableSelection().removeData("draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled").unbind("drag",onDrag),self.$el.append(el),self._prepareElementsByNode(el,node),self._updateContainerHeight(),self.engine._addedNodes.push(node),self._triggerAddEvent(),self._triggerChangeEvent(),self.engine.endUpdate(),$(ui.draggable).unbind("drag",onDrag),$(ui.draggable).removeData("_gridstack_node"),$(ui.draggable).removeData("_gridstack_node_orig"),self.$el.trigger("dropped",[originalNode,node]),!1}))}};return GridStack.prototype._triggerChangeEvent=function(){if(!this.engine._batchMode){var elements=this.engine.getDirtyNodes(!0);elements&&elements.length&&(this.engine._layoutsNodesChange(elements),this._triggerEvent("change",elements)),this.engine._saveInitial()}},GridStack.prototype._triggerAddEvent=function(){this.engine._batchMode||this.engine._addedNodes&&this.engine._addedNodes.length>0&&(this.engine._layoutsNodesChange(this.engine._addedNodes),this.engine._addedNodes.forEach((function(n){delete n._dirty})),this._triggerEvent("added",this.engine._addedNodes),this.engine._addedNodes=[])},GridStack.prototype._triggerRemoveEvent=function(){this.engine._batchMode||this.engine._removedNodes&&this.engine._removedNodes.length>0&&(this._triggerEvent("removed",this.engine._removedNodes),this.engine._removedNodes=[])},GridStack.prototype._triggerEvent=function(name,data){var event=new CustomEvent(name,{detail:data});this.el.dispatchEvent(event)},GridStack.prototype._initStyles=function(){this._stylesId&&Utils.removeStylesheet(this._stylesId),this._stylesId="gridstack-style-"+(1e5*Math.random()).toFixed(),this._styles=Utils.createStylesheet(this._stylesId,this.el.parentNode),null!==this._styles&&(this._styles._max=0)},GridStack.prototype._updateStyles=function(maxHeight){if(null!==this._styles&&void 0!==this._styles){var prefix="."+this.opts._class+" ."+this.opts.itemClass,self=this,getHeight;if(void 0===maxHeight&&(maxHeight=this._styles._max),this._initStyles(),this._updateContainerHeight(),this.opts.cellHeight&&!(0!==this._styles._max&&maxHeight<=this._styles._max)&&(getHeight=this.opts.verticalMargin&&this.opts.cellHeightUnit!==this.opts.verticalMarginUnit?function(nbRows,nbMargins){return nbRows&&nbMargins?"calc("+(self.opts.cellHeight*nbRows+self.opts.cellHeightUnit)+" + "+(self.opts.verticalMargin*nbMargins+self.opts.verticalMarginUnit)+")":self.opts.cellHeight*nbRows+self.opts.verticalMargin*nbMargins+self.opts.cellHeightUnit}:function(nbRows,nbMargins){return self.opts.cellHeight*nbRows+self.opts.verticalMargin*nbMargins+self.opts.cellHeightUnit},0===this._styles._max&&Utils.insertCSSRule(this._styles,prefix,"min-height: "+getHeight(1,0)+";",0),maxHeight>this._styles._max)){for(var i=this._styles._max;i<maxHeight;++i)Utils.insertCSSRule(this._styles,prefix+'[data-gs-height="'+(i+1)+'"]',"height: "+getHeight(i+1,i)+";",i),Utils.insertCSSRule(this._styles,prefix+'[data-gs-min-height="'+(i+1)+'"]',"min-height: "+getHeight(i+1,i)+";",i),Utils.insertCSSRule(this._styles,prefix+'[data-gs-max-height="'+(i+1)+'"]',"max-height: "+getHeight(i+1,i)+";",i),Utils.insertCSSRule(this._styles,prefix+'[data-gs-y="'+i+'"]',"top: "+getHeight(i,i)+";",i);this._styles._max=maxHeight}}},GridStack.prototype._updateContainerHeight=function(){if(!this.engine._batchMode){var row=this.engine.getRow();row<this.opts.minRow&&(row=this.opts.minRow);var cssMinHeight=parseInt(this.$el.css("min-height"));if(cssMinHeight>0){var verticalMargin=this.opts.verticalMargin,minRow=Math.round((cssMinHeight+verticalMargin)/(this.cellHeight()+verticalMargin));row<minRow&&(row=minRow)}this.$el.attr("data-gs-current-row",row),this.opts.cellHeight&&(this.opts.verticalMargin?this.opts.cellHeightUnit===this.opts.verticalMarginUnit?this.$el.css("height",row*(this.opts.cellHeight+this.opts.verticalMargin)-this.opts.verticalMargin+this.opts.cellHeightUnit):this.$el.css("height","calc("+(row*this.opts.cellHeight+this.opts.cellHeightUnit)+" + "+(row*(this.opts.verticalMargin-1)+this.opts.verticalMarginUnit)+")"):this.$el.css("height",row*this.opts.cellHeight+this.opts.cellHeightUnit))}},GridStack.prototype._setupRemovingTimeout=function(el){var self=this,node=$(el).data("_gridstack_node");!node._removeTimeout&&this.opts.removable&&(node._removeTimeout=setTimeout((function(){el.addClass("grid-stack-item-removing"),node._isAboutToRemove=!0}),this.opts.removeTimeout))},GridStack.prototype._clearRemovingTimeout=function(el){var node=$(el).data("_gridstack_node");node._removeTimeout&&(clearTimeout(node._removeTimeout),node._removeTimeout=null,el.removeClass("grid-stack-item-removing"),node._isAboutToRemove=!1)},GridStack.prototype._prepareElementsByNode=function(el,node){var self=this,cellWidth,cellFullHeight,dragOrResize=function(event,ui){var x=Math.round(ui.position.left/cellWidth),y=Math.floor((ui.position.top+cellFullHeight/2)/cellFullHeight),width,height;if("drag"===event.type){var distance=ui.position.top-node._prevYPix;if(node._prevYPix=ui.position.top,Utils.updateScrollPosition(el[0],ui,distance),el.data("inTrashZone")||x<0||x>=self.engine.column||y<0||!self.engine.float&&y>self.engine.getRow()){if(node._temporaryRemoved)return;!0===self.opts.removable&&self._setupRemovingTimeout(el),x=node._beforeDragX,y=node._beforeDragY,self.placeholder.detach(),self.placeholder.hide(),self.engine.removeNode(node),self._updateContainerHeight(),node._temporaryRemoved=!0}else self._clearRemovingTimeout(el),node._temporaryRemoved&&(self.engine.addNode(node),self.placeholder.attr("data-gs-x",x).attr("data-gs-y",y).attr("data-gs-width",width).attr("data-gs-height",height).show(),self.$el.append(self.placeholder),node.el=self.placeholder.get(0),node._temporaryRemoved=!1)}else if("resize"===event.type){if(x<0)return;width=Math.round(ui.size.width/cellWidth),height=Math.round((ui.size.height+self.verticalMargin())/cellFullHeight)}var lastTriedWidth=void 0!==width?width:node.lastTriedWidth,lastTriedHeight=void 0!==height?height:node.lastTriedHeight;!self.engine.canMoveNode(node,x,y,width,height)||node.lastTriedX===x&&node.lastTriedY===y&&node.lastTriedWidth===lastTriedWidth&&node.lastTriedHeight===lastTriedHeight||(node.lastTriedX=x,node.lastTriedY=y,node.lastTriedWidth=width,node.lastTriedHeight=height,self.engine.moveNode(node,x,y,width,height),self._updateContainerHeight(),"resize"===event.type&&$(event.target).trigger("gsresize",node))},onStartMoving=function(event,ui){self.$el.append(self.placeholder);var o=$(this);self.engine.cleanNodes(),self.engine.beginUpdate(node),cellWidth=self.cellWidth();var strictCellHeight=self.cellHeight();cellFullHeight=(self.$el.height()+self.verticalMargin())/parseInt(self.$el.attr("data-gs-current-row")),self.placeholder.attr("data-gs-x",o.attr("data-gs-x")).attr("data-gs-y",o.attr("data-gs-y")).attr("data-gs-width",o.attr("data-gs-width")).attr("data-gs-height",o.attr("data-gs-height")).show(),node.el=self.placeholder.get(0),node._beforeDragX=node.x,node._beforeDragY=node.y,node._prevYPix=ui.position.top;var minHeight=node.minHeight||1,verticalMargin=self.opts.verticalMargin;self.dd.resizable(el,"option","minWidth",cellWidth*(node.minWidth||1)),self.dd.resizable(el,"option","minHeight",strictCellHeight*minHeight+(minHeight-1)*verticalMargin),"resizestart"===event.type&&o.find(".grid-stack-item").trigger("resizestart")},onEndMoving=function(event,ui){var o=$(this),gridstackID=self.el.id,originalWidth=$(event.target).css("width"),originalHeight=$(event.target).css("height"),parentWidth=self.el.clientWidth,parentHeight=self.el.clientHeight;if(o.data("_gridstack_node")){self.placeholder.detach(),node.el=o.get(0),self.placeholder.hide();var disableCollision=self.opts.disableCollisionClass,gridToNotify;if(node._isAboutToRemove)el.data("_gridstack_node")._grid._triggerRemoveEvent(),el.removeData("_gridstack_node"),el.remove();else self._clearRemovingTimeout(el),node._temporaryRemoved?(Utils.removePositioningStyles(o),o.attr("data-gs-x",node._beforeDragX).attr("data-gs-y",node._beforeDragY).attr("data-gs-width",node.width).attr("data-gs-height",node.height),node.x=node._beforeDragX,node.y=node._beforeDragY,node._temporaryRemoved=!1,self.engine.addNode(node)):(Utils.removePositioningStyles(o),o.attr("data-gs-x",node.x).attr("data-gs-y",node.y).attr("data-gs-width",node.width).attr("data-gs-height",node.height));self._updateContainerHeight(),self._triggerChangeEvent(),self.engine.endUpdate();var nestedGrids=o.find(".grid-stack");if(nestedGrids.length&&"resizestop"===event.type&&(nestedGrids.each((function(index,el){el.gridstack.onResizeHandler()})),o.find(".grid-stack-item").trigger("resizestop"),o.find(".grid-stack-item").trigger("gsresizestop")),"resizestop"===event.type&&(self.$el.trigger("gsresizestop",o),void 0!==disableCollision&&$(event.target).hasClass(disableCollision))){var realWidth=ui.size.width/parentWidth*100+"%",realHeight=ui.size.height/parentHeight*100+"%",realLeft=100*parseFloat(ui.position.left/parseFloat(parentWidth))+"%",realTop=100*parseFloat(ui.position.top/parseFloat(parentHeight))+"%";o.css({height:realHeight,width:realWidth,top:realTop,left:realLeft}),o.attr("data-columnrealtop",realTop).attr("data-columnrealleft",realLeft)}if(void 0!==disableCollision&&"dragstop"===event.type&&$(event.target).hasClass(disableCollision)){var realLeft=100*parseFloat(ui.position.left/parseFloat(parentWidth))+"%",realTop=100*parseFloat(ui.position.top/parseFloat(parentHeight))+"%",realWidth=event.target.style.width,realHeight=event.target.style.height;o.css({height:realHeight,width:realWidth,top:realTop,left:realLeft}),o.attr("data-columnrealtop",realTop).attr("data-columnrealleft",realLeft)}$("#"+gridstackID+" .gridstack-save").show()}};this.dd.draggable(el,{start:onStartMoving,stop:onEndMoving,drag:dragOrResize}).resizable(el,{start:onStartMoving,stop:onEndMoving,resize:dragOrResize}),(node.noMove||this.opts.disableDrag||this.opts.staticGrid)&&this.dd.draggable(el,"disable"),(node.noResize||this.opts.disableResize||this.opts.staticGrid)&&this.dd.resizable(el,"disable"),this._writeAttr(el,node)},GridStack.prototype._prepareElement=function(el,triggerAddEvent){triggerAddEvent=void 0!==triggerAddEvent&&triggerAddEvent;var self=this;(el=$(el)).addClass(this.opts.itemClass);var node=this._readAttr(el,{el:el.get(0),_grid:this});node=this.engine.addNode(node,triggerAddEvent),el.data("_gridstack_node",node),this._prepareElementsByNode(el,node)},GridStack.prototype._writeAttr=function(el,node){el=$(el),void 0!==(node=node||{}).x&&el.attr("data-gs-x",node.x),void 0!==node.y&&el.attr("data-gs-y",node.y),void 0!==node.width&&el.attr("data-gs-width",node.width),void 0!==node.height&&el.attr("data-gs-height",node.height),void 0!==node.autoPosition&&el.attr("data-gs-auto-position",!!node.autoPosition||null),void 0!==node.minWidth&&el.attr("data-gs-min-width",node.minWidth),void 0!==node.maxWidth&&el.attr("data-gs-max-width",node.maxWidth),void 0!==node.minHeight&&el.attr("data-gs-min-height",node.minHeight),void 0!==node.maxHeight&&el.attr("data-gs-max-height",node.maxHeight),void 0!==node.noResize&&el.attr("data-gs-no-resize",!!node.noResize||null),void 0!==node.noMove&&el.attr("data-gs-no-move",!!node.noMove||null),void 0!==node.locked&&el.attr("data-gs-locked",!!node.locked||null),void 0!==node.resizeHandles&&el.attr("data-gs-resize-handles",node.resizeHandles),void 0!==node.id&&el.attr("data-gs-id",node.id)},GridStack.prototype._readAttr=function(el,node){return el=$(el),(node=node||{}).x=el.attr("data-gs-x"),node.y=el.attr("data-gs-y"),node.width=el.attr("data-gs-width"),node.height=el.attr("data-gs-height"),node.autoPosition=Utils.toBool(el.attr("data-gs-auto-position")),node.maxWidth=el.attr("data-gs-max-width"),node.minWidth=el.attr("data-gs-min-width"),node.maxHeight=el.attr("data-gs-max-height"),node.minHeight=el.attr("data-gs-min-height"),node.noResize=Utils.toBool(el.attr("data-gs-no-resize")),node.noMove=Utils.toBool(el.attr("data-gs-no-move")),node.locked=Utils.toBool(el.attr("data-gs-locked")),node.resizeHandles=el.attr("data-gs-resize-handles"),node.id=el.attr("data-gs-id"),node},GridStack.prototype.setAnimation=function(enable){enable?this.$el.addClass("grid-stack-animate"):this.$el.removeClass("grid-stack-animate")},GridStack.prototype.addWidget=function(el,opt,y,width,height,autoPosition,minWidth,maxWidth,minHeight,maxHeight,id){return void 0!==opt&&"object"!=typeof opt?this.addWidget(el,{x:opt,y:y,width:width,height:height,autoPosition:autoPosition,minWidth:minWidth,maxWidth:maxWidth,minHeight:minHeight,maxHeight:maxHeight,id:id}):(el=$(el),opt&&this.engine._prepareNode(opt),this._writeAttr(el,opt),this.$el.append(el),this.makeWidget(el))},GridStack.prototype.makeWidget=function(el){return el=$(el),this._prepareElement(el,!0),this._updateContainerHeight(),this._triggerAddEvent(),this._triggerChangeEvent(!0),el.get(0)},GridStack.prototype.willItFit=function(x,y,width,height,autoPosition){var node={x:x,y:y,width:width,height:height,autoPosition:autoPosition};return this.engine.canBePlacedWithRespectToHeight(node)},GridStack.prototype.removeWidget=function(el,detachNode){var node=(el=$(el)).data("_gridstack_node");node||(node=this.engine.getNodeDataByDOMEl(el.get(0))),el.removeData("_gridstack_node"),this.dd.draggable(el,"destroy").resizable(el,"destroy"),this.engine.removeNode(node,detachNode),this._triggerRemoveEvent(),this._triggerChangeEvent(!0)},GridStack.prototype.removeAll=function(detachNode){this.engine.nodes.forEach((function(node){var el=$(node.el);el.removeData("_gridstack_node"),this.dd.draggable(el,"destroy").resizable(el,"destroy")}),this),this.engine.removeAll(detachNode),this._triggerRemoveEvent()},GridStack.prototype.destroy=function(detachGrid){$(window).off("resize",this.onResizeHandler),!1===detachGrid?(this.removeAll(!1),this.$el.removeClass(this.opts._class),delete this.$el.get(0).gridstack):this.$el.remove(),Utils.removeStylesheet(this._stylesId),this.engine&&(this.engine=null)},GridStack.prototype.resizable=function(el,val){var self=this;return(el=$(el)).each((function(index,el){var node=(el=$(el)).data("_gridstack_node");node&&(node.noResize=!val,node.noResize?self.dd.resizable(el,"disable"):self.dd.resizable(el,"enable"))})),this},GridStack.prototype.movable=function(el,val){var self=this;return(el=$(el)).each((function(index,el){var node=(el=$(el)).data("_gridstack_node");node&&(node.noMove=!val,node.noMove?(self.dd.draggable(el,"disable"),el.removeClass("ui-draggable-handle")):(self.dd.draggable(el,"enable"),el.addClass("ui-draggable-handle")))})),this},GridStack.prototype.enableMove=function(doEnable,includeNewWidgets){this.movable(this.$el.children("."+this.opts.itemClass),doEnable),includeNewWidgets&&(this.opts.disableDrag=!doEnable)},GridStack.prototype.enableResize=function(doEnable,includeNewWidgets){this.resizable(this.$el.children("."+this.opts.itemClass),doEnable),includeNewWidgets&&(this.opts.disableResize=!doEnable)},GridStack.prototype.disable=function(){this.movable(this.$el.children("."+this.opts.itemClass),!1),this.resizable(this.$el.children("."+this.opts.itemClass),!1),this.$el.trigger("disable")},GridStack.prototype.enable=function(){this.movable(this.$el.children("."+this.opts.itemClass),!0),this.resizable(this.$el.children("."+this.opts.itemClass),!0),this.$el.trigger("enable")},GridStack.prototype.locked=function(el,val){return(el=$(el)).each((function(index,el){var node=(el=$(el)).data("_gridstack_node");node&&(node.locked=val||!1,el.attr("data-gs-locked",node.locked?"yes":null))})),this},GridStack.prototype.maxHeight=function(el,val){return(el=$(el)).each((function(index,el){var node=(el=$(el)).data("_gridstack_node");node&&(isNaN(val)||(node.maxHeight=val||!1,el.attr("data-gs-max-height",val)))})),this},GridStack.prototype.minHeight=function(el,val){return(el=$(el)).each((function(index,el){var node=(el=$(el)).data("_gridstack_node");node&&(isNaN(val)||(node.minHeight=val||!1,el.attr("data-gs-min-height",val)))})),this},GridStack.prototype.maxWidth=function(el,val){return(el=$(el)).each((function(index,el){var node=(el=$(el)).data("_gridstack_node");node&&(isNaN(val)||(node.maxWidth=val||!1,el.attr("data-gs-max-width",val)))})),this},GridStack.prototype.minWidth=function(el,val){return(el=$(el)).each((function(index,el){var node=(el=$(el)).data("_gridstack_node");node&&(isNaN(val)||(node.minWidth=val||!1,el.attr("data-gs-min-width",val)))})),this},GridStack.prototype._updateElement=function(el,callback){var node=(el=$(el).first()).data("_gridstack_node");if(node){var self=this;this.engine.cleanNodes(),this.engine.beginUpdate(node),callback.call(this,el,node),this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate()}},GridStack.prototype.resize=function(el,width,height){this._updateElement(el,(function(el,node){width=null!=width?width:node.width,height=null!=height?height:node.height,this.engine.moveNode(node,node.x,node.y,width,height)}))},GridStack.prototype.move=function(el,x,y){this._updateElement(el,(function(el,node){x=null!=x?x:node.x,y=null!=y?y:node.y,this.engine.moveNode(node,x,y,node.width,node.height)}))},GridStack.prototype.update=function(el,x,y,width,height){this._updateElement(el,(function(el,node){x=null!=x?x:node.x,y=null!=y?y:node.y,width=null!=width?width:node.width,height=null!=height?height:node.height,this.engine.moveNode(node,x,y,width,height)}))},GridStack.prototype.compact=function(){if(0!==this.engine.nodes.length){this.batchUpdate(),this.engine._sortNodes();var nodes=this.engine.nodes;this.engine.nodes=[],nodes.forEach((function(node){node.noMove||node.locked||(node.autoPosition=!0),this.engine.addNode(node,!1),node._dirty=!0}),this),this.commit()}},GridStack.prototype.verticalMargin=function(val,noUpdate){if(void 0===val)return this.opts.verticalMargin;var heightData=Utils.parseHeight(val);this.opts.verticalMarginUnit=heightData.unit,this.opts.verticalMargin=heightData.height,noUpdate||this._updateStyles()},GridStack.prototype.cellHeight=function(val,noUpdate){if(void 0===val){if(this.opts.cellHeight&&"auto"!==this.opts.cellHeight)return this.opts.cellHeight;var o=this.$el.children("."+this.opts.itemClass).first(),height=o.attr("data-gs-height"),verticalMargin=this.opts.verticalMargin;return Math.round((o.outerHeight()-(height-1)*verticalMargin)/height)}var heightData=Utils.parseHeight(val);this.opts.cellHeightUnit===heightData.unit&&this.opts.cellHeight===heightData.height||(this.opts.cellHeightUnit=heightData.unit,this.opts.cellHeight=heightData.height,noUpdate||this._updateStyles())},GridStack.prototype.cellWidth=function(){return Math.round(this.$el.outerWidth()/this.opts.column)},GridStack.prototype.getCellFromPixel=function(position,useOffset){var containerPos=void 0!==useOffset&&useOffset?this.$el.offset():this.$el.position(),relativeLeft=position.left-containerPos.left,relativeTop=position.top-containerPos.top,columnWidth=Math.floor(this.$el.width()/this.opts.column),rowHeight=Math.floor(this.$el.height()/parseInt(this.$el.attr("data-gs-current-row")));return{x:Math.floor(relativeLeft/columnWidth),y:Math.floor(relativeTop/rowHeight)}},GridStack.prototype.batchUpdate=function(){this.engine.batchUpdate()},GridStack.prototype.commit=function(){this.engine.commit(),this._triggerRemoveEvent(),this._triggerAddEvent(),this._triggerChangeEvent()},GridStack.prototype.isAreaEmpty=function(x,y,width,height){return this.engine.isAreaEmpty(x,y,width,height)},GridStack.prototype.setStatic=function(staticValue){this.opts.staticGrid=!0===staticValue,this.enableMove(!staticValue),this.enableResize(!staticValue),this._setStaticClass()},GridStack.prototype._setStaticClass=function(){var staticClassName="grid-stack-static";!0===this.opts.staticGrid?this.$el.addClass(staticClassName):this.$el.removeClass(staticClassName)},GridStackEngine.prototype._layoutsNodesChange=function(nodes){this._layouts&&!this._ignoreLayoutsNodeChange&&this._layouts.forEach((function(layout,column){layout&&column!==this.column&&(column<this.column?this._layouts[column]=void 0:nodes.forEach((function(node){var n=layout.find((function(l){return l._id===node._id}));if(n){var ratio=column/this.column;node.y!==node._origY&&(n.y+=node.y-node._origY),node.x!==node._origX&&(n.x=Math.round(node.x*ratio)),node.width!==node._origW&&(n.width=Math.round(node.width*ratio))}}),this))}),this)},GridStackEngine.prototype._updateNodeWidths=function(oldColumn,column,nodes){if(this.nodes.length&&oldColumn!==column){var copy=[this.nodes.length];if(this.nodes.forEach((function(n,i){copy[i]={x:n.x,y:n.y,width:n.width,_id:n._id}})),this._layouts=this._layouts||[],this._layouts[oldColumn]=copy,1===column&&nodes&&nodes.length){var top=0;nodes.forEach((function(n){n.x=0,n.width=1,n.y=Math.max(n.y,top),top=n.y+n.height}))}else nodes=Utils.sort(this.nodes,-1,oldColumn);var cacheNodes=this._layouts[column]||[],lastIndex=this._layouts.length-1;0===cacheNodes.length&&column>oldColumn&&column<lastIndex&&(cacheNodes=this._layouts[lastIndex]||[]).length&&(oldColumn=lastIndex,cacheNodes.forEach((function(cacheNode){var j=nodes.findIndex((function(n){return n&&n._id===cacheNode._id}));-1!==j&&(nodes[j].x=cacheNode.x,nodes[j].y=cacheNode.y,nodes[j].width=cacheNode.width)})),cacheNodes=[]);var newNodes=[];cacheNodes.forEach((function(cacheNode){var j=nodes.findIndex((function(n){return n&&n._id===cacheNode._id}));-1!==j&&(nodes[j].x=cacheNode.x,nodes[j].y=cacheNode.y,nodes[j].width=cacheNode.width,newNodes.push(nodes[j]),nodes[j]=null)}));var ratio=column/oldColumn;nodes.forEach((function(node){node&&(node.x=1===column?0:Math.round(node.x*ratio),node.width=1===column||1===oldColumn?1:Math.round(node.width*ratio)||1,newNodes.push(node))})),newNodes=Utils.sort(newNodes,-1,column),this._ignoreLayoutsNodeChange=!0,this.batchUpdate(),this.nodes=[],newNodes.forEach((function(node){this.addNode(node,!1),node._dirty=!0}),this),this.commit(),delete this._ignoreLayoutsNodeChange}},GridStackEngine.prototype._saveInitial=function(){this.nodes.forEach((function(n){n._origX=n.x,n._origY=n.y,n._origW=n.width,n._origH=n.height,delete n._dirty}))},GridStack.prototype.column=function(column,doNotPropagate){if(void 0===column)return this.opts.column;if(this.opts.column!==column){var oldColumn=this.opts.column,domNodes;if(1===column?this._prevColumn=oldColumn:delete this._prevColumn,this.$el.removeClass("grid-stack-"+oldColumn),this.$el.addClass("grid-stack-"+column),this.opts.column=this.engine.column=column,!0!==doNotPropagate)this.opts.oneColumnModeDomSort&&1===column&&(domNodes=[],this.$el.children("."+this.opts.itemClass).each((function(index,el){var node=$(el).data("_gridstack_node");node&&domNodes.push(node)})),domNodes.length||(domNodes=void 0)),this.engine._updateNodeWidths(oldColumn,column,domNodes),this.engine._ignoreLayoutsNodeChange=!0,this._triggerChangeEvent(),delete this.engine._ignoreLayoutsNodeChange}},GridStack.prototype.float=function(val){if(void 0===val)return this.opts.float||!1;this.opts.float!==val&&(this.opts.float=this.engine.float=val||!1,val||(this.engine._packNodes(),this.engine._notify(),this._triggerChangeEvent()))},GridStack.prototype.getRow=function(){return this.engine.getRow()},GridStack.prototype.on=function(eventName,callback){var names;-1===eventName.indexOf(" ")?"change"===eventName||"added"===eventName||"removed"===eventName?(this._gsEventHandler=this._gsEventHandler||{},this._gsEventHandler[eventName]=function(event){callback(event,event.detail)},this.el.addEventListener(eventName,this._gsEventHandler[eventName])):this.$el.on(eventName,callback):eventName.split(" ").forEach((function(name){this.on(name,callback)}),this)},GridStack.prototype.off=function(eventName){var names;-1===eventName.indexOf(" ")?"change"===eventName||"added"===eventName||"removed"===eventName?this._gsEventHandler&&this._gsEventHandler[eventName]&&(this.el.removeEventListener(eventName,this._gsEventHandler[eventName]),delete this._gsEventHandler[eventName]):this.$el.off(eventName):eventName.split(" ").forEach((function(name){this.off(name,callback)}),this)},GridStack.prototype.setGridWidth=obsolete(GridStack.prototype.column,"setGridWidth","column","v0.5.3"),GridStack.prototype.setColumn=obsolete(GridStack.prototype.column,"setColumn","column","v0.6.4"),GridStackEngine.prototype.getGridHeight=obsolete(GridStackEngine.prototype.getRow,"getGridHeight","getRow","v1.0.0"),scope.GridStack=GridStack,scope.GridStack.Utils=Utils,scope.GridStack.Engine=GridStackEngine,scope.GridStack.DragDropPlugin=GridStackDragDropPlugin,GridStack.init=function(opts,elOrString){elOrString||(elOrString=".grid-stack");var el=$(elOrString).get(0);if(el)return el.gridstack||(el.gridstack=new GridStack(el,opts)),el.gridstack},GridStack.initAll=function(opts,selector){selector||(selector=".grid-stack");var grids=[];return $(selector).each((function(index,el){el.gridstack||(el.gridstack=new GridStack(el,Utils.clone(opts))),grids.push(el.gridstack)})),grids},scope.GridStack}));