/** 
 *  CSS MAGICIAN
 *
 * @category front office features
 * @authors presta-magician.com <contact@presta-magician.com>
 * @copyright Presta Magician 2015-2020
 * @version 1.0.0
 * @website <https://www.presta-magician.com> 
 * @file admin.js 
 * @license: GPLv2
   International Registered Trademark & Property of Presta Magician
Css Magician for Wordpress basic version
 **/
(function ($) {
    $(document).ready((function () {

        $('#cssm_select_id').on('change', function () {
            value = $(this).val();
            $('#cssm_select_id option:selected').removeAttr('selected');
            $('#cssm_select_id option[value="' + value + '"]').prop('selected', true);

            var values = {
                cssm_select_id: $('#cssm_select_id').val(),
                action: "getallsettings",
                security: cssm_admin_ajax_object.security
            };

            $.ajax({
                type: "POST",
                url: ajaxurl,
                headers: {
                    "cache-control": "no-cache"
                },
                data: values,
                success: function (response) {
                    $("#cssm_allowed_ips").val(response.ip);
                    $("input[name=cssm_display_stylizer][value=" + response.display + "]").attr('checked', 'checked');
                    $("input[name=cssm_activate_stylizer][value=" + response.active + "]").attr('checked', 'checked');
                },
                dataType: "json"
            });
        });

        $("#cssm_create_theme").on("click", (function () {
            var values = {
                cssm_theme_name: $('#cssm_theme_name').val(),
                action: "updatename",
                security: cssm_admin_ajax_object.security
            };

            $.ajax({
                type: "POST",
                url: ajaxurl,
                headers: {
                    "cache-control": "no-cache"
                },
                beforeSend: function () {
                    $("#cssm_create_theme .fas").show();
                },
                data: values,
                success: function (response) {
                    $('#cssm_select_id').append('<option value="' + response + '">' + $('#cssm_theme_name').val() + '</option>')
                },
                complete: function (data) {
                    $("#cssm_create_theme .fas").hide();
                }
            });
        }));
        $("#cssm_getmyIP").on("click", (function () {
            var values = {
                action: "getip",
                security: cssm_admin_ajax_object.security
            };
            $.ajax({
                type: "POST",
                url: ajaxurl,
                headers: {
                    "cache-control": "no-cache"
                },
                data: values,
                beforeSend: function () {
                    $("#cssm_getmyIP .fas").show();
                },
                success: function (myip) {
                    var length;
                    $("#cssm_allowed_ips").attr("value").length > 0 ? $("#cssm_allowed_ips").attr("value", $("#cssm_allowed_ips").attr("value") + "," + myip) : $("#cssm_allowed_ips").attr("value", myip)
                },
                complete: function (data) {
                    $("#cssm_getmyIP .fas").hide();
                }
            });
        }));

        $("#cssm_save_all_settings").on("click", (function () {
            var values = {
                cssm_select_id: $('#cssm_select_id').val(),
                cssm_display_stylizer: $("input[name='cssm_display_stylizer']:checked").val(),
                cssm_activate_stylizer: $("input[name='cssm_activate_stylizer']:checked").val(),
                cssm_allowed_ips: $('#cssm_allowed_ips').val(),
                action: "saveallsettings",
                security: cssm_admin_ajax_object.security
            };
            $.ajax({
                type: "POST",
                url: ajaxurl,
                headers: {
                    "cache-control": "no-cache"
                },
                data: values,
                beforeSend: function () {
                    $("#cssm_save_all_settings .fas").show();
                },
                success: function (response) {},
                complete: function (data) {
                    $("#cssm_save_all_settings .fas").hide();
                }
            });
        }));

        $("#cssm_delete_theme").on("click", (function () {
            if($('#cssm_select_id').val()!=0){
            var values = {
                cssm_select_id: $('#cssm_select_id').val(),
                action: "deletetheme",
                security: cssm_admin_ajax_object.security
            };

            Swal.fire({
                title: cssmTranslate.vmutcconfirm,
                text: cssmTranslate.vmutcconfirm2,
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: cssmTranslate.vmutccancel,
                confirmButtonText: cssmTranslate.vmutcyesdelete,
                customClass: {
                    container: 'always-on-top'
                }
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        type: "POST",
                        url: ajaxurl,
                        headers: {
                            "cache-control": "no-cache"
                        },
                        data: values,
                        beforeSend: function () {
                            $("#cssm_delete_theme .fas").show();
                        },
                        success: function (response) {},
                        complete: function (data) {
                            $("#cssm_delete_theme .fas").hide();
                            $('#cssm_select_id').find('option:selected').remove();                           
                        }
                    });
                } else {
                    return false;
                }
            });
        }
      
        }));

        $('#cssm_theme_name').keypress(function (evt) {
            var keyCode = evt.which ? evt.which : evt.keyCode;
            var accept = 'abcdefghijklmnopqrstuvwxyz_0123456789';
            if (accept.indexOf(String.fromCharCode(keyCode)) >= 0) {
                return true;
            } else {
                return false;
            }
        });
        
    }));

})(jQuery);