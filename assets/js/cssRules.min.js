"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}function getCSSRules(children,options,matchedCSS){var allCSS;return children.reduce((function(matchedCSS,child,i){return matchedCSS=getCSSRulesByElement(child,options,matchedCSS)}),matchedCSS||{})}function getCSSRulesByElement(el,options,matchedCSS){var matches=el.matches||el.webkitMatchesSelector||el.mozMatchesSelector||el.msMatchesSelector||el.oMatchesSelector;if(!matches)return matchedCSS;el.matches=matches;var sheets=options.document.styleSheets||window.document.styleSheets;for(var i in sheets){var sheet=sheets[i];if(sheetIsAllowed(sheet,options))try{var matchedCSSRule=_filterCSSRulesByElement(el,sheet.rules||sheet.cssRules,options,matchedCSS[i]||{});matchedCSSRule&&(matchedCSS[i]=matchedCSSRule,matchedCSS[i].stylesheet=sheet.href)}catch(e){if("SecurityError"!==e.name)throw e}}return matchedCSS}function _filterCSSRulesByElement(el,rules,options,matchedCSS){var _loop=function _loop(i){var rule=rules[i];if(rule.selectorText){var allSelector=rule.selectorText.replace(/@charset.*?;/g,""),selectors;if(ruleIsAllowed(allSelector,options))splitSelectors(allSelector).forEach((function(selector){var trimmedSelector,normalizedSelector;try{trimmedSelector=selector.trim();var unique=Math.random().toString(16);normalizedSelector=trimmedSelector.replace(/\\:/g,unique).replace(/:+.*$/gi,(function(match){return[":first-child",":last-child",":first-letter",":first-line",":first"].includes(match.replace(/::/g,":"))?match:""})).replace(new RegExp(unique,"g"),"\\:"),el.matches(normalizedSelector)&&(matchedCSS[i]={selectors:matchedCSS[i]&&matchedCSS[i].selectors||[],properties:rule.cssText.substring(rule.cssText.indexOf("{"))},-1===matchedCSS[i].selectors.indexOf(selector)&&matchedCSS[i].selectors.push(selector))}catch(e){-1!=="@charset".indexOf(rule.selectorText)&&console.error("ERROR",rule.type,"[".concat(trimmedSelector,"]"),"[[".concat(normalizedSelector,"]]"),"(((".concat(rule.selectorText,")))"),e)}}))}else if((rule.rules||rule.cssRules)&&(rule.conditionText||rule.media)){var conditionText=rule.conditionText||rule.media[0];if(mediaIsAllowed(conditionText,options)){var nestedRules=_filterCSSRulesByElement(el,rule.rules||rule.cssRules,options,{});nestedRules&&(matchedCSS[i]={before:"@media "+conditionText+" {",children:nestedRules,after:"}"})}}};for(var i in rules)_loop(i);return Object.keys(matchedCSS).length?matchedCSS:void 0}function sheetIsAllowed(sheet,options){if(!sheet)return!1;if(!sheet.ownerNode)return!0;var checkStylesheet=function checkStylesheet(sheet,sheetMatch){switch(sheet.ownerNode.nodeName.toLowerCase()){case"style":case"link":for(var nodeAttrs=sheet.ownerNode.attributes,attrs={},i=0;i<nodeAttrs.length;i++)attrs[nodeAttrs[i].name]=nodeAttrs[i].value;var attributesJSON;return-1!==JSON.stringify(attrs).indexOf(sheetMatch)}},whitelisted=!0,blacklisted=!1,whitelistStylesheets=options.whitelist&&options.whitelist.stylesheet;if(whitelistStylesheets){var sheetMatches=Array.isArray(whitelistStylesheets)?whitelistStylesheets:[whitelistStylesheets];whitelisted=sheetMatches.some((function(sheetMatch){return checkStylesheet(sheet,sheetMatches)}))}var blacklistStylesheets=options.blacklist&&options.blacklist.stylesheet,_sheetMatches;blacklistStylesheets&&(blacklisted=(Array.isArray(blacklistStylesheets)?blacklistStylesheets:[blacklistStylesheets]).some((function(sheetMatch){return checkStylesheet(sheet,sheetMatch)})));return!1!==whitelisted&&!0!==blacklisted}function mediaIsAllowed(mediaString,options){if(!options||!mediaString)return!1;var whitelisted=!0,blacklisted=!1,whitelistMedia=options.whitelist&&options.whitelist.media,mediaMatches;whitelistMedia&&(whitelisted=(Array.isArray(whitelistMedia)?whitelistMedia:[whitelistMedia]).some((function(mediaMatch){return-1!==mediaString.indexOf(mediaMatch)})));var blacklistMedia=options.blacklist&&options.blacklist.media,_mediaMatches;blacklistMedia&&(blacklisted=(Array.isArray(blacklistMedia)?blacklistMedia:[blacklistMedia]).some((function(mediaMatch){return-1!==mediaString.indexOf(mediaMatch)})));return!1!==whitelisted&&!0!==blacklisted}function ruleIsAllowed(ruleString,options){if(!options||!ruleString)return!1;var whitelisted=!0,blacklisted=!1,whitelistRules=options.whitelist&&options.whitelist.rule,ruleMatches;whitelistRules&&(whitelisted=(Array.isArray(whitelistRules)?whitelistRules:[whitelistRules]).some((function(ruleMatch){return-1!==ruleString.indexOf(ruleMatch)})));var blacklistRules=options.blacklist&&options.blacklist.rule,_ruleMatches;blacklistRules&&(blacklisted=(Array.isArray(blacklistRules)?blacklistRules:[blacklistRules]).some((function(ruleMatch){return-1!==ruleString.indexOf(ruleMatch)})));return!1!==whitelisted&&!0!==blacklisted}function deepMergeRules(rulesArray){function isObject(item){return item&&"object"==typeof item&&!Array.isArray(item)}function mergeDeep(target){for(var _len=arguments.length,sources=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)sources[_key-1]=arguments[_key];if(!sources.length)return target;var source=sources.shift();if(isObject(target)&&isObject(source))for(var key in source)isObject(source[key])?(target[key]||Object.assign(target,_defineProperty({},key,{})),mergeDeep(target[key],source[key])):Object.assign(target,_defineProperty({},key,source[key]));return mergeDeep.apply(void 0,[target].concat(sources))}return mergeDeep.apply(void 0,[{}].concat(_toConsumableArray(rulesArray)))}function serializeCSSRules(rules){return rules?Object.keys(rules).map((function(key){var rule=rules[key],css="";return rule&&rule.stylesheet&&(css="/* "+rule.stylesheet+" */\n"),rule&&rule.selectors?(rule.stylesheet||(css+="\n"),css+=rule.selectors.join(","),css+=rule.properties,css+="\n"):rule&&rule.before?(css+=rule.before,css+=serializeCSSRules(rule.children),css+=rule.after):rule&&rule instanceof Object&&(css+=serializeCSSRules(rule)),css})).join(""):""}function splitSelectors(selectors){function isAtRule(selector){return 0===selector.indexOf("@")}if(isAtRule(selectors))return[selectors];for(var splitted=[],parens=0,angulars=0,soFar="",i=0,len=selectors.length;i<len;i++){var char=selectors[i];if("("===char)parens+=1;else if(")"===char)parens-=1;else if("["===char)angulars+=1;else if("]"===char)angulars-=1;else if(","===char&&!parens&&!angulars){splitted.push(soFar.trim()),soFar="";continue}soFar+=char}return splitted.push(soFar.trim()),splitted}